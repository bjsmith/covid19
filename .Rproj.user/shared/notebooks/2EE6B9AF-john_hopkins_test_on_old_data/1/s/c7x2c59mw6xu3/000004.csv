"0","#now let's model the exponential and linear trend."
"0","#maybe just the last 3 weeks?"
"0","days_to_subtract<-21"
"0","date_to_start<-max(new_cases$case_date)-days_to_subtract"
"0","new_cases[`New Cases`<0,`New Cases`:=0]"
"0","prediction_tables<-lapply(unique(new_cases$`Country/Region`),function(cname){"
"0","  #print(cname)"
"0","  # linear_model <- lm(new_cases[`Country/Region`==cname & case_date>=date_to_start,"
"0","  #           .(`New Cases`,Day=1:.N)],"
"0","  #    formula = `New Cases`~Day)"
"0","  "
"0","  exponential_model <- glm(new_cases[`Country/Region`==cname & case_date>=date_to_start,"
"0","            .(`New Cases`,Day=1:.N)],"
"0","            formula = `New Cases`~I(Day^2)+Day,"
"0","            family=poisson(link = ""log"")"
"0","            )"
"0","  "
"0","  # if(AIC(exponential_model)<AIC(linear_model)){"
"0","    predict_model<-exponential_model"
"0","  #   #print(""using exp model"")"
"0","  # }else{"
"0","  #   predict_model<-linear_model"
"0","  #   #print(""using linear model"")"
"0","  # }"
"0","  predict_tb<-data.table(""Day""=days_to_subtract+0:21-1,"
"0","                       ""Country/Region""=cname)"
"0","  predict_tb[,case_date:=date_to_start+Day+2]"
"0","  predict_tb[[""CasePrediction""]]<- predict(predict_model,predict_tb,type=""response"")"
"0","  return(predict_tb)"
"0","})"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"2","glm.fit: algorithm did not converge"
"2","glm.fit: fitted rates numerically 0 occurred"
"0","prediction_table<-rbindlist(prediction_tables)"
"0","new_cases$CaseDataType<-""Actual"""
"0","prediction_table$CaseDataType<-""Prediction"""
"0","cc_graph<-rbind(new_cases[,.(CaseData=NewCasesMA,"
"0","                             ConfirmedCases=as.numeric(`Confirmed Cases`),"
"0","                       case_date,"
"0","                       `Country/Region`,"
"0","                       CaseDataType=""Actual"""
"0","                       )],"
"0","                prediction_table[,.(CaseData=CasePrediction,"
"0","                                    ConfirmedCases=NA,"
"0","                                    case_date,"
"0","                                    `Country/Region`,"
"0","                                    CaseDataType=""Prediction"")]"
"0",")"
"0","last_confirmed_cases <- cc_graph[CaseDataType==""Actual"",.(LastConfirmedCases=.SD[.N,ConfirmedCases]),`Country/Region`]"
"0","cc_graph<-merge(cc_graph,last_confirmed_cases)"
"0","cc_graph[CaseDataType==""Prediction"",ConfirmedCases:=LastConfirmedCases+cumsum(CaseData),`Country/Region`]"
"0","cc_graph$LastConfirmedCases<-NULL"
"0","# cc_graph <-"
"0","#   cc_graph %>%"
"0","#   group_by(`Country/Region`) %>% "
"0","#   mutate(NCMAModeled=cumsum(ifelse(row_number()==1,NewCasesMA,DeltaCaseData))) %>%"
"0","#   data.table"

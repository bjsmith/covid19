"0","days_to_subtract<-10"
"0","date_to_start<-as.Date(max(new_cases$case_date))-days_to_subtract"
"0","prediction_tables<-lapply(unique(new_cases$`Country/Region`),function(cname){"
"0","  print(cname)"
"0","  linear_model <- lm(new_cases[`Country/Region`==cname & case_date>=date_to_start,"
"0","            .(DeltaNewCasesMA,Day=1:.N)],"
"0","     formula = DeltaNewCasesMA~Day)"
"0","  "
"0","  # exponential_model <- lm(new_cases[`Country/Region`==cname & case_date>=date_to_start,"
"0","  #           .(DeltaNewCasesMA,Day=1:.N)],"
"0","  #           formula = DeltaNewCasesMA~exp(Day)"
"0","  #           )"
"0","  "
"0","  # if(AIC(exponential_model)<AIC(linear_model)){"
"0","  #   predict_model<-exponential_model"
"0","  #   pred_type<-""exponential"""
"0","  #   print(""using exp model"")"
"0","  # }else{"
"0","    predict_model<-linear_model"
"0","    pred_type<-""linear"""
"0","    print(""using linear model"")"
"0","  # }"
"0","  predict_tb<-data.table(""Day""=days_to_subtract+1:21,"
"0","                       ""Country/Region""=cname)"
"0","  predict_tb[,case_date:=date_to_start+Day]"
"0","  predict_tb[[""CasePrediction""]]<- predict(predict_model,predict_tb,)"
"0","  predict_tb[[""PredictionType""]]<-pred_type"
"0","  return(predict_tb)"
"0","})"
"1","[1]"
"1"," ""Thailand"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Japan"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Singapore"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Nepal"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Malaysia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Canada"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Australia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Cambodia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Sri Lanka"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Germany"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Finland"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""United Arab Emirates"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Philippines"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""India"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Italy"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Sweden"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Spain"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Belgium"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Egypt"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Lebanon"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Iraq"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Oman"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Afghanistan"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Bahrain"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Kuwait"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Algeria"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Croatia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Switzerland"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Austria"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Israel"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Pakistan"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Brazil"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Georgia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Greece"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""North Macedonia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Norway"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Romania"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Estonia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Netherlands"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""San Marino"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Belarus"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Iceland"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Lithuania"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Mexico"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""New Zealand"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Nigeria"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Ireland"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Luxembourg"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Monaco"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Qatar"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Ecuador"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Azerbaijan"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Armenia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Dominican Republic"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Indonesia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Portugal"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Andorra"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Latvia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Morocco"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Saudi Arabia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Senegal"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Argentina"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Chile"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Jordan"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Ukraine"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Hungary"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Liechtenstein"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Poland"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Tunisia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Bosnia and Herzegovina"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Slovenia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""South Africa"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Bhutan"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Cameroon"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Colombia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Costa Rica"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Peru"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Serbia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Slovakia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Togo"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""French Guiana"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Malta"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Martinique"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Bulgaria"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Maldives"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Bangladesh"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Paraguay"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Albania"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Cyprus"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Brunei"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""United States"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Burkina Faso"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Holy See"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Mongolia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Panama"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""China"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Iran"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Korea, South"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""France"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Cruise Ship"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""United Kingdom"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Denmark"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Czechia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Taiwan*"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Vietnam"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Russia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Moldova"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Bolivia"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Honduras"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Congo (Kinshasa)"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Cote d'Ivoire"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Jamaica"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Reunion"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Turkey"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Cuba"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"1","[1]"
"1"," ""Guyana"""
"1","
"
"1","[1]"
"1"," ""using linear model"""
"1","
"
"0","prediction_table<-rbindlist(prediction_tables)"
"0","new_cases$CaseDataType<-""Actual"""
"0","prediction_table$CaseDataType<-""Prediction"""
"0","cc_graph<-rbind(new_cases[,.(DeltaCaseData=DeltaNewCasesMA,"
"0","                             NewCasesMA,"
"0","                       case_date,"
"0","                       `Country/Region`,"
"0","                       CaseDataType=""Actual"""
"0","                       )],"
"0","                prediction_table[,.(DeltaCaseData=CasePrediction,"
"0","                                    NewCasesMA=NA,"
"0","                                    case_date,"
"0","                                    `Country/Region`,"
"0","                                    CaseDataType=""Prediction"")]"
"0",")"
"0","#to make the summing work properly, you have to copy the first value in"
"0","# new_cases <-"
"0","#   new_cases %>%"
"0","#   group_by(`Country/Region`) %>% "
"0","#   mutate(DeltaNewCasesMA=ifelse(row_number()==1,NewCasesMA,DeltaNewCasesMA)) %>%"
"0","#   data.table"
"0","cc_graph <-"
"0","  cc_graph %>%"
"0","  group_by(`Country/Region`) %>% "
"0","  mutate(NCMAModeled=cumsum(ifelse(row_number()==1,NewCasesMA,DeltaCaseData))) %>%"
"0","  data.table"
"0","cc_graph[`Country/Region`==""Germany""]"

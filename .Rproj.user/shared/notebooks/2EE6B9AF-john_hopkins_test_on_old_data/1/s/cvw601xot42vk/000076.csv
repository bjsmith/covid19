"0","new_cases<-confirmed_cases_long_bycountry[!is.na(NewCasesMA)]"
"0","# if(threshold<min(new_cases[`Country/Region`==""Mainland China"",`Confirmed Cases`])){"
"0","#        new_cases <-"
"0","#          new_cases[`Country/Region`!=""Mainland China""]"
"0","#      }"
"0","case_limit<-40"
"0","days_limit <- 21"
"0","#now we want a list of the lines"
"0","#with an x axis point either at the end of the graph,"
"0","#or at the end of the line, whichever is first,     "
"0","country_labels<-new_cases[,"
"0","                              .(intercept_date=max(case_date)),"
"0","                              by=`Country/Region`] %>% "
"0"," merge(new_cases[,.(`Country/Region`,case_date,NewCasesMA)],"
"0","                     by.x=c(""Country/Region"",""intercept_date""),"
"0","                     by.y=c(""Country/Region"",""case_date""),"
"0","       all.x=TRUE,all.y=FALSE)"
"0","country_labels[,NewCasesGroup:=round(log(NewCasesMA,10),1)]"
"0","country_labels_grouped<- country_labels[,"
"0","                                        .(Countries=paste0(`Country/Region`, collapse="", ""),"
"0","                                          GroupedNewCases=mean(NewCasesMA),"
"0","                                          `Country/Region` = .SD[`Country/Region`][[1]]"
"0","                                          )"
"0","                                        ,by=.(NewCasesGroup,intercept_date)] %>% .[GroupedNewCases>2]"
"0","x_breaks  <- seq(min(new_cases$case_date),max(new_cases$case_date),7)"
"0","myplot<-ggplot(new_cases"
"0","      ,"
"0","      aes(x=as.Date(case_date),y=NewCasesMA,"
"0","          group=`Country/Region`))+"
"0"," geom_line(size=1,alpha=0.3)+"
"0","  theme_classic()+"
"0"," #geom_point(alpha=0.5)+"
"0"," scale_x_date(#breaks=x_breaks,"
"0","   date_breaks = ""7 days"","
"0","                    minor_breaks=NULL,date_labels=""%b %d"")+"
"0"," coord_cartesian(xlim=c(min(new_cases$case_date),max(new_cases$case_date)+7),"
"0","                 ylim=c(10,max(new_cases$NewCasesMA)))+"
"0"," scale_y_continuous(trans = ""log10"","
"0","                    breaks = c(2,5,10,20,50,100,200,500,1000,2000,5000,10000,20000,50000,100000),"
"0","                    minor_breaks=NULL,"
"0","                    labels = scales::comma,"
"0","                    sec.axis = dup_axis())+"
"0"," #geom_vline(xintercept = 0,linetype=""dashed"")+"
"0"," #geom_hline(yintercept = threshold,,linetype=""dashed"")+"
"0"," labs(title=paste0(""New confirmed cases by day and country""),"
"0","      x=paste0(""Date""),"
"0","      y=""New Cases (7 day rolling average)"","
"0","      color=""Date Country Reached Threshold"","
"0","      caption=""Source: John Hopkins Dataset"")+"
"0"," theme(legend.position = ""none"")+"
"0"," geom_text(data=country_labels_grouped,"
"0","           aes(x=intercept_date,y=GroupedNewCases,label=Countries),"
"0","           hjust=0,size=2,fontface=""bold"")"
"0","htmlwidgets::saveWidget(as_widget(ggplotly(myplot)),""new_cases.html"",selfcontained=FALSE)"
"2","NaNs produced"
"2","Transformation introduced infinite values in continuous y-axis"
"0","  "
"0","myplot"

"0","confirmed_cases_long_bycountry[order(case_date),"
"0","                               `New Cases`:=(`Confirmed Cases`-shift(`Confirmed Cases`)),"
"0","                               `Country/Region`]"
"0","  "
"0","#moving average over 7 days; figure is dated on the last day of the average window."
"0","confirmed_cases_long_bycountry[order(case_date),"
"0","                               NewCasesMA:=shift(zoo::rollapply(`New Cases`,7,mean),6),"
"0","                               `Country/Region`]"
"2","Supplied 44 items to be assigned to group 1 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 2 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 3 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 4 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 5 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 6 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 7 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 8 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 9 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 10 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 11 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 12 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 13 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 14 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 15 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 16 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 17 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 18 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 19 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 20 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 21 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 22 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 23 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 24 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 25 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 26 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 27 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 28 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 29 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 30 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 31 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 32 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 33 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 34 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 35 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 36 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 37 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 38 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 39 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 40 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 41 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 42 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 43 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 44 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 45 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 46 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 47 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 48 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 49 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 50 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 51 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 52 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 53 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 54 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 55 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 56 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 57 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 58 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 59 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 60 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 61 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 62 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 63 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 64 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 65 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 66 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 67 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 68 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 69 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 70 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 71 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 72 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 73 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 74 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 75 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 76 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 77 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 78 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 79 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 80 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 81 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 82 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 83 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 84 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 85 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 86 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 87 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 88 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 89 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 90 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 91 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 92 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 93 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 94 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 95 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 96 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 97 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 98 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 99 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 100 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 101 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 102 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 103 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 104 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 105 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 106 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 107 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 108 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 109 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 110 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 111 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 112 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 113 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 114 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 115 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"2","Supplied 44 items to be assigned to group 116 of size 50 in column 'NewCasesMA' (recycled leaving remainder of 6 items)."
"0","new_cases<-confirmed_cases_long_bycountry[!is.na(NewCasesMA)]"
"0","if(threshold<min(new_cases[`Country/Region`==""Mainland China"",`Confirmed Cases`])){"
"0","       new_cases <- "
"0","         new_cases[`Country/Region`!=""Mainland China""]"
"0","     }"
"2","no non-missing arguments to min; returning Inf"
"0","case_limit<-40"
"0","days_limit <- 21"
"0","#now we want a list of the lines"
"0","#with an x axis point either at the end of the graph,"
"0","#or at the end of the line, whichever is first,     "
"0","country_labels<-new_cases[,"
"0","                              .(intercept_day=min(days_limit,max(DaysPastThreshold))),"
"0","                              by=`Country/Region`] %>% .[!is.na(intercept_day)] %>%"
"0"," #and then at that x-axis point, we want the y-axis point.  "
"0"," merge(new_cases[,.(`Country/Region`,DaysPastThreshold,NewCasesMA,DatePastThreshold)],"
"0","                     by.x=c(""Country/Region"",""intercept_day""),"
"0","                     by.y=c(""Country/Region"",""DaysPastThreshold""),"
"0","       all.x=TRUE,all.y=FALSE)"
"0","x_breaks  <- seq(-7,days_limit,7)"
"0","x_labels <- c(paste(abs(x_breaks[1]),""Days Before""),"
"0","             x_breaks[2:(length(x_breaks)-1)],"
"0","             paste(x_breaks[length(x_breaks)],""Days After""))"
"0","myplot<-ggplot(new_cases"
"0","      ,"
"0","      aes(x=DaysPastThreshold,y=NewCasesMA,"
"0","          group=`Country/Region`,color=DatePastThreshold))+"
"0"," geom_line(size=1,alpha=0.3)+"
"0"," #geom_point(alpha=0.5)+"
"0"," scale_x_continuous(limits=c(-7,days_limit),"
"0","                    breaks=x_breaks,"
"0","                    labels = x_labels,"
"0","                    minor_breaks=NULL)+"
"0"," coord_cartesian(xlim=c(-7,days_limit+3),ylim=c(1,max(new_cases$NewCasesMA)))+"
"0"," scale_y_continuous(trans = ""log10"","
"0","                    breaks = c(1,2,5,10,20,50,100,200,500,1000,2000,5000,10000,20000,50000,100000),"
"0","                    minor_breaks=NULL,"
"0","                    labels = scales::comma,"
"0","                    sec.axis = dup_axis())+"
"0"," geom_vline(xintercept = 0,linetype=""dashed"")+"
"0"," #geom_hline(yintercept = threshold,,linetype=""dashed"")+"
"0"," labs(title=paste0(""Growth in new cases by day from the "",threshold,"" case mark, by country""),"
"0","      x=paste0(""Days past first day with "",threshold,"" cases""),"
"0","      y=""New Cases (7 day rolling average)"","
"0","      color=""Date Country Reached Threshold"")+"
"0"," theme(legend.position = ""none"")+"
"0"," geom_text(data=country_labels,"
"0","           aes(x=intercept_day,y=NewCasesMA,label=`Country/Region`),"
"0","           hjust=0,size=2,fontface=""bold"")"
"0","  "
"0","  myplot"
